#!/bin/sh

# jgreve: Time for SCRIPTPATH to die, too much of a headache to
# try and keep everything aligned. (2018-05-13)
# Instead we'll just run bin/scripts from the project folder.
# (Which is is pretty much what we've always been doing)

# Caller needs to set the E2JK_CONFIG to the config file we should be using.

pip3 install -r requirements.txt

export E2JK_CONFIG=bin/config_patas_D4.yml
echo "$0: E2JK_CONFIG=$E2JK_CONFIG"

# Setup Stanford CoreNLP Server
echo "Setting up Stanford Server"
# source "bin/coref2/bin/activate"

# export CORE_NLP="stanford-corenlp-full-2018-02-27"
export CORE_NLP="/NLP_TOOLS/CoreNLP"

python3 -m pynlp -t 600000 & # Dont throw timeout exceptions until 10 min lockup

sleep 10s # Allow server to initiate

bin/summarizer -c "$E2JK_CONFIG"

# shutdown Stanford server
wget "localhost:9000/shutdown?key=`cat /tmp/corenlp.shutdown`" -O -