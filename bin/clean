#!/bin/sh

# clean: a script to delete nonessential files like logs and output
# Intended to clean up before a run of the main program.
#
# Lets just asuume we always run this from the project directory.
# otherwise the path complexity is a big headache for little benefit.
# jgreve, 2018-05-10

set -u
# blow up on undefined env-vars

source bin/summ.env
# check our output directory


echo "clean: OUT_DIR=$OUT_DIR" >&2
if [ -d "$OUT_DIR" ]; then
    if [ -z "$(ls "$OUT_DIR")" ]; then
        echo "clean: OUT_DIR empty, nothing to clean up" >&2
    else
        echo "clean: OUT_DIR is not empty, cleaning up...." >&2
        rm $OUT_DIR/*
    fi
else
    mkdir -p "$OUT_DIR"
fi
# verify the directory still exists (mkdir may have failed?)
if [ ! -d "$OUT_DIR" ]; then
    echo "clean: ERROR! expected OUT_DIR to be a directory? OUT_DIR=$OUT_DIR" >&2
    exit 1
fi

echo "clean: LOG_DIR=$LOG_DIR" >&2
mkdir -p "$LOG_DIR"
if [ -d "$LOG_DIR" ]; then
    if [ -z "$(ls "$LOG_DIR")" ]; then
        echo "clean: LOG_DIR empty, nothing to clean up" >&2
    else
        echo "clean: LOG_DIR is not empty, cleaning up...." >&2
        rm  $LOG_DIR/*
    fi
fi
# verify the directory still exists (mkdir may have failed?)
if [ ! -d "$LOG_DIR" ]; then
    echo "clean: ERROR! expected LOG_DIR to be a directory? LOG_DIR=$LOG_DIR" >&2
    exit 1
fi

